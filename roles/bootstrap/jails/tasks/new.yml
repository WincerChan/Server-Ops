- name: Check if jail is already created
  shell: "qjail list {{ jail_name }}"
  register: jail_check

- name:
  when: "{{ 'Error' in jail_check.stdout }}"
  block:
    - name: Create Qjail
      shell: qjail create -4 {{ jail_ip }} -n lo1 {{ jail_name }}

    - name: Enable Raw Socket Rustc Jail
      shell: "qjail config -k {{ jail_name }}"

    - name: Restart pf
      service:
        name: pf
        state: restarted

    - name: Start Jails
      shell: "qjail start {{ jail_name }}"
    
# - name: Mount Host Local Bin
#   mount:
#     src: /usr/local/bin
#     path: "{{ jail_dir }}{{ jail_name }}/usr/local/host-bin"
#     fstype: nullfs
#     state: mounted
#     opts: ro